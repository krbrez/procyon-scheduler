<!doctype html>
<html lang="en-US">
<head>
<style>
table, th, td {
    border: 1px solid black;
    /*make empty or closed meeting a header box which will be set to a different color in this style area
    */
}
th {
  background-color:grey;
}
</style>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Organizer</title>
<!--link href="cs3733Template.css" rel="stylesheet" type="text/css"-->
<script type="text/javascript">
//JavaScript Goes Here
var base_url = "https://r37b9qrsj3.execute-api.us-east-2.amazonaws.com/Alpha/";
var create_url = base_url + "createschedule";    // POST
var showweek_url = base_url + "showweek";    // PUT


function processResponse(result) {
  // Can grab any DIV or SPAN HTML element and can then manipulate its
  // contents dynamically via javascript
  console.log("result:" + result);
  var js = JSON.parse(result);

  var respString = js["response"];
  var id = js["id"];
  var code = js["secretCode"];

  // Update computation result
  document.getElementById("secretCodeOrganizer").value = code;
  document.getElementById("scheduleIdOrganizer").value = id;
  window.alert(respString);

  // this is the json string that is gotten back, instead of the alert I should parse it then use it in the calendar
  // currently the date to view needs to be a monday, but I should add my findMonday so that it can be any day


}

function handleClick(e) {
  var form = document.createSchedule;
  var name = form.scheduleName.value;
  var f = document.getElementById("timeSlotDuration");
  var timeslotSize = f.options[f.selectedIndex].value; //""20";  // form.arg2.value;
  var e = document.getElementById("startHour");
  var startHour = e.options[e.selectedIndex].value; //"10:00:00.00";
  var g = document.getElementById("endHour");
  var endHour = g.options[g.selectedIndex].value; //"17:00:00.00";
  var startDate = form.StartDate.value; //"2018-11-29";
  var endDate = form.EndDate.value; //"2018-11-30";

  var data = {};
  data["name"] = name;
  data["startTime"] = startHour;
  data["startDate"] = startDate;
  data["endTime"] = endHour;
  data["endDate"] = endDate;
  data["blockSize"] = timeslotSize;

  var js = JSON.stringify(data);
  console.log("JS:" + js);
  var xhr = new XMLHttpRequest();
  xhr.open("POST", create_url, true);

  // send the collected data as JSON
  xhr.send(js);

  // This will process results and update HTML as appropriate.
  xhr.onloadend = function () {
    console.log(xhr);
    console.log(xhr.request);
    if (xhr.readyState == XMLHttpRequest.DONE) {
      console.log ("XHR:" + xhr.responseText);
      processResponse(xhr.responseText);
    } else {
      window.alert("Oops, something went wrong!");
    }
  };
}

function showWeek(e) {
  var form = document.showWeekForm;
  var id = document.getElementById("showWeekID").value;
  var date = document.getElementById("showWeekDate").value;

  var data = {};
  data["id"] = id;
  data["startDay"] = date;

  var js = JSON.stringify(data);
  console.log("JS:" + js);
  var xhr = new XMLHttpRequest();
  xhr.open("PUT", showweek_url, true);

  // send the collected data as JSON
  xhr.send(js);

  // This will process results and update HTML as appropriate.
  xhr.onloadend = function () {
    console.log(xhr);
    if (xhr.readyState == XMLHttpRequest.DONE) {
      console.log ("XHR:" + xhr.responseText); // this is the console.log that spits out the json file
      var js = JSON.parse(xhr.responseText);
      var meetings = js["meetings"];
      console.log(meetings);
      var startDay = js["startDay"];
      console.log(startDay);
      var dateTime = meetings[0]["dateTime"];
      console.log (dateTime);
      // var parsedDateTime = JSON.parse(dateTime);
      var firstScheduleDay = dateTime["dayOfMonth"];
      console.log(firstScheduleDay)
      var firstScheduleMonth = dateTime["month"];
      var firstScheduleYear = dateTime["year"];
      var firstScheduleHour = dateTime["hourOfDay"];
      if (firstScheduleHour < 10){
        firstScheduleHour = "0" + firstScheduleHour.toString()
      }
      else {
        firstScheduleHour = firstScheduleHour.toString()
      }
      var firstScheduleMinute = dateTime["minute"];
      if (firstScheduleMinute < 10){
        firstScheduleMinute = "0" + firstScheduleMinute.toString()
      }
      else {
        firstScheduleMinute = firstScheduleMinute.toString()
      }
      var firstScheduleSecond = dateTime["second"];
      if (firstScheduleMinute < 10){
        firstScheduleSecond = "0" + firstScheduleSecond.toString()
      }
      else {
        firstScheduleSecond = firstScheduleSecond.toString()
      }

      var scheduleStringFormat = firstScheduleYear.toString() + "-" + firstScheduleMonth.toString() + "-" + firstScheduleDay.toString() + "T" + firstScheduleHour + ":" + firstScheduleMinute + ":" + firstScheduleSecond;
      console.log(scheduleStringFormat);
      var mondayStringFormat = startDay + "T" + firstScheduleHour + ":" + firstScheduleMinute + ":" + firstScheduleSecond;
      //new Date('2018-12-05T00:00:00')
      var firstScheduleDate = new Date(scheduleStringFormat);
      var firstMondayDate = new Date(mondayStringFormat);


      // for this function to work it needs two full dates and a zero
      setWeek(meetings, firstScheduleDate, firstMondayDate);



	    console.log(meetings); // this is the console.log that displays the array of meetings

    } else {
      window.alert("Oops, something went wrong!");
    }
  };
}

</script>
</head>
<body>
  <div class="container">
    <header> <a href="">
      <h4 class="logo">Organizer View</h4>
      </a>
    </header>
  <section class = "initialOrganizerInput" id="initialOrgainzerInput">
  <fieldset>
    <legend>Create a Schedule</legend>
  <form name="createSchedule" method="post">
    <input type="text" name="scheduleName" value="ScheduleName" />
    <select id="timeSlotDuration">
      <option value="0">Timeslot Duration</option>
      <option value="10">10</option>
      <option value="15">15</option>
      <option value="20">20</option>
      <option value="30">30</option>
      <option value="60">60</option>
    </select>
    <select id="startHour">
      <option value="99:99:99.99">Start Hour</option>
      <option value="00:00:00.00">00:00</option>
      <option value="01:00:00.00">01:00</option>
      <option value="02:00:00.00">02:00</option>
      <option value="03:00:00.00">03:00</option>
      <option value="04:00:00.00">04:00</option>
      <option value="05:00:00.00">05:00</option>
      <option value="06:00:00.00">06:00</option>
      <option value="07:00:00.00">07:00</option>
      <option value="08:00:00.00">08:00</option>
      <option value="09:00:00.00">09:00</option>
      <option value="10:00:00.00">10:00</option>
      <option value="11:00:00.00">11:00</option>
      <option value="12:00:00.00">12:00</option>
      <option value="13:00:00.00">13:00</option>
      <option value="14:00:00.00">14:00</option>
      <option value="15:00:00.00">15:00</option>
      <option value="16:00:00.00">16:00</option>
      <option value="17:00:00.00">17:00</option>
      <option value="18:00:00.00">18:00</option>
      <option value="19:00:00.00">19:00</option>
      <option value="20:00:00.00">20:00</option>
      <option value="21:00:00.00">21:00</option>
      <option value="22:00:00.00">22:00</option>
      <option value="23:00:00.00">23:00</option>
    </select>
    <select id="endHour">
      <option value="99:99:99.99">End Hour</option>
      <option value="00:00:00.00">00:00</option>
      <option value="01:00:00.00">01:00</option>
      <option value="02:00:00.00">02:00</option>
      <option value="03:00:00.00">03:00</option>
      <option value="04:00:00.00">04:00</option>
      <option value="05:00:00.00">05:00</option>
      <option value="06:00:00.00">06:00</option>
      <option value="07:00:00.00">07:00</option>
      <option value="08:00:00.00">08:00</option>
      <option value="09:00:00.00">09:00</option>
      <option value="10:00:00.00">10:00</option>
      <option value="11:00:00.00">11:00</option>
      <option value="12:00:00.00">12:00</option>
      <option value="13:00:00.00">13:00</option>
      <option value="14:00:00.00">14:00</option>
      <option value="15:00:00.00">15:00</option>
      <option value="16:00:00.00">16:00</option>
      <option value="17:00:00.00">17:00</option>
      <option value="18:00:00.00">18:00</option>
      <option value="19:00:00.00">19:00</option>
      <option value="20:00:00.00">20:00</option>
      <option value="21:00:00.00">21:00</option>
      <option value="22:00:00.00">22:00</option>
      <option value="23:00:00.00">23:00</option>
    </select>
    Start Date <input type="date" name="StartDate">
    End Date <input type="date" name="EndDate">
    <button type="button" onclick="JavaScript:handleClick(this)">Create a Schedule of your own!</button><br>
  </form>
  </fieldset>
    <br>
</section>
<section class = "OrganizerOptions" id="OrganizerOptions">
  <br>
  <fieldset>
    <legend>Display One Week of a Schedule</legend>
    <form name="showWeekForm">
    	Display Schedule with ID: <input type="text" name="showWeekID" id="showWeekID" value=""> on the week of: <input type="date" name="showWeekDate" id="showWeekDate"><button type="button" onclick="JavaScript:showWeek(this)">Submit</button><br>
    </form>
  </fieldset>
  <br>
  <fieldset>
    <legend>Edit This Schedule</legend>
    <form>Change the Start Date of the Schedule to<input type="date" name="extendEndDate"><input type="submit"></form>
    <form>Change the End Date of the Schedule to<input type="date" name="extendStartDate"><input type="submit"></form>
    <form>Open all meetings on
      <select>
      <option value="openDayOfWeek">Day of the Week</option>
      <option value="MonOpen">Mondays</option>
      <option value="TueOpen">Tuesdays</option>
      <option value="WedOpen">Wednesdays</option>
      <option value="ThuOpen">Thursdays</option>
      <option value="FriOpen">Fridays</option>
    </select>
    <input type="submit"></form>
    <form>Close all meetings on
      <select>
      <option value="closeDayOfWeek">Day of the Week</option>
      <option value="MonClose">Mondays</option>
      <option value="TueClose">Tuesdays</option>
      <option value="WedClose">Wednesdays</option>
      <option value="ThuClose">Thursdays</option>
      <option value="FriClose">Fridays</option>
    </select>
    <input type="submit"></form>
    <form>Open all meetings on <input type="date" name="openAllOnDay"><input type="submit"></form>
    <form>Close all meetings on <input type="date" name="closeAllOnDay"><input type="submit"></form>
    <form>Open all meetings at
      <select>
      <option value="openTimeslot">Time Slot</option>
      <option value="slot1">Add timeslots to this dropdown</option>
    </select>
    <input type="submit"></form>
    <form>Close all meetings at
      <select>
      <option value="openTimeslot">Time Slot</option>
      <option value="slot1">Add timeslots to this dropdown</option>
    </select>
    <input type="submit"></form>
  </fieldset>
  </section>
  <br>
  <section class = "OrganizerCalendar" id="OrganizerCalendar">
    <fieldset>
      <legend>Weekly Calendar</legend>
      Your Secret Code for this Schedule is: <input id="secretCodeOrganizer" readonly/>
      and the ID to schedule Meetings is: <input id="scheduleIdOrganizer" readonly/>
      <div id="OrganizerCalendarView"</div>
      <br>

<!--______________________________________________________________________________________________________________________-->
      <script>
      // Begin Calendar3 code

        //TODO: make a function for setting all of the initial input



		var startDate = new Date('2018-12-11T00:00:00'); // a date
		var endDate = new Date('2018-12-14T23:00:00'); // a date
		var timeSlotSizeString = "10"; //10, 15, 20, 30, 60
		var timeSlotSize = parseInt(timeSlotSizeString);
		var startTime = startDate.getHours(); // a time
		var endTime = endDate.getHours(); // a time

		// the variables that are gotten from those initial data values
		var startDayOfWeek = startDate.getDay();
		var endDayOfWeek = endDate.getDay();
		var timeSlotAmount = 60 / window.timeSlotSize * (window.endTime - window.startTime);

		// sets up variables that are used in display
		Months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec' ];

		//Sets up the unfinished weeks that will be created in the calendar by setting the first Monday and final Friday
		// = in javascript is stupid and doesnt make a copy of the variable
		var mondayOfStartWeek = new Date();
		mondayOfStartWeek.setTime(startDate.getTime());
		mondayOfStartWeek.setDate(mondayOfStartWeek.getDate());

		console.log("startDate0: " + startDate)
		// functions to get the monday of the start week and the friday of the end week
		for (var i=startDayOfWeek; i>1; i--){
			mondayOfStartWeek.setDate(mondayOfStartWeek.getDate() - 1);
		}

		console.log("Monday of start Week: " + mondayOfStartWeek);

		//Build the calendar, this requires lots of information from outside of the function
		function buildCalendar(meetings, mondayOfBuildWeek, scheduleStartDate, isFirstWeek){
      var htmlString = "";

		  if (isFirstWeek == 1){
		    startOfSchedule = window.startDate;
		    buildScheduleDate = window.mondayOfStartWeek;
		    buildScheduleMonth = window.mondayOfStartWeek.getMonth();
		    buildScheduleYear = window.mondayOfStartWeek.getFullYear();
		  }
		  else {
		    startOfSchedule = scheduleStartDate
		    buildScheduleDate = mondayOfBuildWeek;
		    buildScheduleMonth = mondayOfBuildWeek.getMonth();
		    buildScheduleYear = mondayOfBuildWeek.getFullYear();
		  }
		  console.log("buildScheduleDate " + buildScheduleDate)

		  // this is just a loop to get the words for the month
		  for (var i=0; i<12; i++){
		    if (buildScheduleMonth == i){
		      var monthDisplay = Months[i];
		    }
		  }
		  // this prints out the heading of the table
		  // TODO MAKE THE BUTTON FOR LINKING PREV WEEK, that will go here in a document.write
		  htmlString +=(monthDisplay + " " + buildScheduleYear);
		  // TODO MAKE THE BUTTON FOR LINKING NEXT WEEK, that will go here in a document.write
			htmlString += ('<table><tr><th>TIMESLOT</th><th>Mon '
		  + (buildScheduleDate.getDate()+0) + '</th><th>Tue '
		  + (buildScheduleDate.getDate()+1) + '</th><th>Wed '
		  + (buildScheduleDate.getDate()+2) + '</th><th>Thu '
		  + (buildScheduleDate.getDate()+3) + '</th><th>Fri '
		  + (buildScheduleDate.getDate()+4) + '</th></tr>');

		  // print out of the main section of the table
		  for (var i=buildScheduleDate.getHours(), d=1, arrayCounter = 0; i<window.endDate.getHours(); i+= timeSlotSize/60){
		    htmlString += ('<tr>');
		    htmlString +=('<td>'+ (i) + " - " + (i+timeSlotSize/60) + '</td>'); // TODO fix how time is displayed
		    for (var j=1; j <= 5; j ++){
		      if ((startOfSchedule.getDay()-1) < j && buildScheduleDate.getTime() >= (window.startDate.getTime()) && buildScheduleDate.getTime() < window.endDate.getTime()){
		        htmlString +=("<td>this is the " + d + "th meeting on the "+ j + "th day<br>");
            console.log(meetings[arrayCounter]["label"] + "   .");
            if (meetings[arrayCounter]["label"] != ""){
              htmlString +=(meetings[arrayCounter]["label"]);
            }
            else{
             htmlString +=("Empty Meeting with ID: " + meetings[arrayCounter]["id"] + "");
            }

		        //all in this area will be inside of the box on the calendar

            console.log(arrayCounter);
            console.log("meetings inside the loop: " + meetings[arrayCounter]["id"]);
            console.log(meetings[arrayCounter]["id"]);
            arrayCounter++;
            htmlString +=("</td>");
		      }
		      else {
		        htmlString +=("<th>This day is out of Schedule!</th>");
		      }
		      // this if else handles the end date of the schedule
		      if (j == 5){
		        buildScheduleDate.setDate(buildScheduleDate.getDate() - 4);
		      }
		      else {
		        buildScheduleDate.setDate(buildScheduleDate.getDate() + 1);
		      }
				}
		    htmlString +=('</tr>');
		    d++;
			}
		  htmlString +=('</table>');
      console.log(htmlString);
      document.getElementById("htmlCalendar").innerHTML = htmlString;
		}// end of function buildCalendar
		//buildCalendar(null,null,1)



		function nextWeekMondayDate(mondayOfCurrentWeek){
		  var returnThisDate = new Date();
		  returnThisDate.setTime(mondayOfCurrentWeek.getTime());
			returnThisDate.setDate(mondayOfCurrentWeek.getDate() + 7);
		  return returnThisDate
		}
		function prevWeekMondayDate(mondayOfCurrentWeek){
		  var returnThisDate = new Date();
		  returnThisDate.setTime(mondayOfCurrentWeek.getTime());
			returnThisDate.setDate(mondayOfCurrentWeek.getDate() - 7);
		  return returnThisDate
		}
		function setWeek(meetings, date, monday){
		  console.log("date and Monday in SetWeek " + date + " " + monday);
		  buildCalendar(meetings, monday, date, 0);
		}
		function findMonday(mondayDate){
		  var findTestMonday = new Date();
		  findTestMonday.setTime(mondayDate.getTime());
		  console.log("date and Monday in FindMonday " + mondayDate + " " + findTestMonday);
		  for (var i=mondayDate.getDay(); i>1; i--){
		  	findTestMonday.setDate(findTestMonday.getDate() - 1);
		  }
		  console.log("date and Monday after FindMonday " + mondayDate + " " + findTestMonday);
		  return findTestMonday
		}
		//USE SetWeek with the Dates for any week other than the first one
		//var testDate = new Date('2018-12-12T05:00:00');
		//var testMonday = findMonday(testDate);
		//setWeek(testDate, testMonday);


		function nextWeekRunner(thisWeekAnyDate){
		  var mondayofthisWeek = findMonday(thisWeekAnyDate);
		  console.log("Monday of this week: " + mondayofthisWeek);
		  var mondayNextWeek = nextWeekMondayDate(mondayofthisWeek);
		  console.log("Monday of next week: " + mondayNextWeek);
		  setWeek(mondayNextWeek,mondayNextWeek);
		}

		function prevWeekRunner(thisWeekAnyDate, thisScheduleStartDate){
		  var mondayofthisWeek = findMonday(thisWeekAnyDate);
		  console.log("Monday of this week: " + mondayofthisWeek);
		  var mondayPrevWeek = prevWeekMondayDate(mondayofthisWeek);
		  console.log("Monday of next week: " + mondayPrevWeek);
		  setWeek(mondayPrevWeek,mondayPrevWeek);
		}
		//prevWeekRunner(testDate);


		function setStartDate(setToThis){
		  startDate = setToThis; // setToThis has to be a date
		}
		function setEndDate(setToThis){
		  endDate = setToThis; // setToThis has to be a date
		}
		function setStartHour(setToThis){
		  startDate.setHours(setToThis); // setToThis has to be an int from 0-23
		}
		function setEndHour(){
		  endDate.setHours(setToThis); // setToThis has to be an int from 0-23
		}



		// this is the copy and pasted section of the code which I don't why it works, but I know it works
		function processResponseCalendar(result) {
		  // Can grab any DIV or SPAN HTML element and can then manipulate its
		  // contents dynamically via javascript
		  console.log("result:" + result);
		  var js = JSON.parse(result);
		  var respString = js["response"];
		  var id = js["id"];             // change to get the information that you need
		  var code = js["secretCode"];   // change to get the information that you need
		   // Update computation result
		  document.getElementById("secretCodeOrganizer").value = code;
		  document.getElementById("scheduleIdOrganizer").value = id;
		  window.alert(respString);
		}

	  </script>
<!--______________________________________________________________________________________________________________________-->


      <div id="htmlCalendar"></div>
      <br><br><br>
      <button type="button" onclick="alert('SCHEDULE DELETE CONFIRMATION')">Delete This Schedule</button>
    </fieldset>
  </section>
</body>
</html>
