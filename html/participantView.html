<!doctype html>
<html lang="en-US">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Participant</title>
<link href="cs3733Template.css" rel="stylesheet" type="text/css">
<script>var __adobewebfontsappname__="dreamweaver"</script>
<script src="http://use.edgefonts.net/source-sans-pro:n2:default.js" type="text/javascript"></script>
<script type="text/javascript">
//JavaScript Goes Here
var base_url = "https://r37b9qrsj3.execute-api.us-east-2.amazonaws.com/Alpha/";
var showweek_url = base_url + "showweek";    // PUT

function showWeek(e) {
  startDate = new Date(); // a date
  endDate = new Date(); // a date
  var form = document.showWeekForm;
  var id = document.getElementById("showWeekID").value;
  var date = document.getElementById("showWeekDate").value;
  var data = {};
  data["id"] = id;
  data["startDay"] = date;
  var js = JSON.stringify(data);
  console.log("JS:" + js);
  var xhr = new XMLHttpRequest();
  xhr.open("PUT", showweek_url, true);
  // send the collected data as JSON
  xhr.send(js);
  // This will process results and update HTML as appropriate.

  // lots of parts of this function (the stack of is statements) will have to moved to a more globally reachable function _____________________________
  xhr.onloadend = function () {
    console.log(xhr);
    if (xhr.readyState == XMLHttpRequest.DONE) {
      console.log ("XHR:" + xhr.responseText); // this is the console.log that spits out the json file
      var js = JSON.parse(xhr.responseText);
      var meetings = js["meetings"];
      var meetingsLength = meetings.length;
      var lastMeeting = meetings[meetingsLength-1];
      var startDay = js["startDay"];
      var timeslotSize = js["blockSize"];
      var dateTime = meetings[0]["dateTime"];
      var dateTimeLast = lastMeeting["dateTime"];
      console.log("dateTimeLast" + dateTimeLast["dayOfMonth"]);
      console.log("dateTime" + dateTime["dayOfMonth"]);

      //grabbing the information for the first day of the schedule
      var firstScheduleDay = dateTime["dayOfMonth"];
      if (firstScheduleDay < 10){
        firstScheduleDay = "0" + firstScheduleDay.toString()
      }
      else {
        firstScheduleDay = firstScheduleDay.toString()
      }
      var firstScheduleMonth = dateTime["month"] + 1;
      if (firstScheduleMonth < 10){
        firstScheduleMonth = "0" + firstScheduleMonth.toString()
      }
      else {
        firstScheduleMonth = firstScheduleMonth.toString()
      }
      var firstScheduleYear = dateTime["year"];
      var firstScheduleHour = dateTime["hourOfDay"];
      if (firstScheduleHour < 10){
        firstScheduleHour = "0" + firstScheduleHour.toString()
      }
      else {
        firstScheduleHour = firstScheduleHour.toString()
      }
      var firstScheduleMinute = dateTime["minute"];
      if (firstScheduleMinute < 10){
        firstScheduleMinute = "0" + firstScheduleMinute.toString()
      }
      else {
        firstScheduleMinute = firstScheduleMinute.toString()
      }
      var firstScheduleSecond = dateTime["second"];
      if (firstScheduleSecond < 10){
        firstScheduleSecond = "0" + firstScheduleSecond.toString()
      }
      else {
        firstScheduleSecond = firstScheduleSecond.toString()
      }

      // grabbing information ofr the last day of the schedule
      var lastScheduleDay = dateTimeLast["dayOfMonth"];
      if (lastScheduleDay < 10){
        lastScheduleDay = "0" + lastScheduleDay.toString()
      }
      else {
        lastScheduleDay = lastScheduleDay.toString()
      }
      var lastScheduleMonth = dateTimeLast["month"] + 1;
      if (lastScheduleMonth < 10){
        lastScheduleMonth = "0" + lastScheduleMonth.toString()
      }
      else {
        lastScheduleMonth = lastScheduleMonth.toString()
      }
      var lastScheduleYear = dateTimeLast["year"];
      var lastScheduleHour = dateTimeLast["hourOfDay"];
      if (lastScheduleHour < 10){
        lastScheduleHour = "0" + lastScheduleHour.toString()
      }
      else {
        lastScheduleHour = lastScheduleHour.toString()
      }
      var lastScheduleMinute = dateTimeLast["minute"];
      if (lastScheduleMinute < 10){
        lastScheduleMinute = "0" + lastScheduleMinute.toString()
      }
      else {
        lastScheduleMinute = lastScheduleMinute.toString()
      }
      var lastScheduleSecond = dateTimeLast["second"];
      if (lastScheduleSecond < 10){
        lastScheduleSecond = "0" + lastScheduleSecond.toString()
      }
      else {
        lastScheduleSecond = lastScheduleSecond.toString()
      }

      // using that information to make the dates
      var scheduleStringFormat = firstScheduleYear.toString() + "-" + firstScheduleMonth + "-" + firstScheduleDay + "T" + firstScheduleHour + ":" + firstScheduleMinute + ":" + firstScheduleSecond;
      console.log(scheduleStringFormat);
      var mondayStringFormat = startDay + "T" + firstScheduleHour + ":" + firstScheduleMinute + ":" + firstScheduleSecond;
      console.log("lastScheduleDay " + lastScheduleDay);
      var endDateStringFormat = lastScheduleYear.toString() + "-" + lastScheduleMonth + "-" + lastScheduleDay + "T" + lastScheduleHour + ":" + lastScheduleMinute + ":" + lastScheduleSecond;
      var firstScheduleDate = new Date(scheduleStringFormat);
      var firstMondayDate = new Date(mondayStringFormat);
      var lastScheduleDate = new Date(endDateStringFormat);

      //setting the start and end date to make the calendar
      setEndDate(lastScheduleDate);
      setStartDate(firstScheduleDate);
      console.log ("StartDate " + startDate);
      console.log ("endDate" + endDate);
      console.log(meetings); // this is the console.log that displays the array of meetings
      setWeek(meetings, firstScheduleDate, firstMondayDate, timeslotSize);

    } else {
      window.alert("Oops, something went wrong!");
    }
  };
}
</script>
</head>
<body>
  <div class="container">
    <header> <a href="">
      <h4 class="logo">Participant View</h4>
      </a>
    </header>
  <section class = "initialParticipantInput" id="initialParticipantInput">
    <fieldset>
      <legend>View a Schedule or Meeting</legend>
      <form>
        Schedule ID: <input type="text" name="ScheduleID" value="">
        <input type="submit" value="Submit">
        <br>
        Meeting ID: <input type="text" name="MeetingID" value="">
        <input type="submit" value="Submit">
      </form>
    </fieldset>
  </section>
  <section class = "ParticipantOptions" id="ParticipantOptions">
    <br>
    <fieldset>
      <legend>Search This Schedule</legend>
      <form>
      <label><input type="checkbox" name="search" value="YearSlots">Find all open timeslots in
        <select>
          <option value="FindYear">Year</option>
          <option value="t18">2018</option>
          <option value="t19">2019</option>
          <option value="t20">2020</option>
        </select>
      </label><br>
      <label><input type="checkbox" name="search" value="MonthSlots">Find all open timeslots in
      <select>
        <option value="FindMonth">Month</option>
        <option value="Jan">January</option>
        <option value="Feb">February</option>
        <option value="Mar">March</option>
        <option value="Apr">April</option>
        <option value="May">May</option>
        <option value="Jun">June</option>
        <option value="Jul">July</option>
        <option value="Aug">August</option>
        <option value="Sep">September</option>
        <option value="Oct">October</option>
        <option value="Nov">November</option>
        <option value="Dec">December</option>
      </select>
    </label><br>
    <label><input type="checkbox" name="search" value="WeekdaySlots">Find all open timeslots on
      <select>
        <option value="searchDayofMonth">Day of the Month</option>
        <option>1</option>
        <option>2</option>
        <option>3</option>
        <option>4</option>
        <option>5</option>
        <option>6</option>
        <option>7</option>
        <option>8</option>
        <option>9</option>
        <option>10</option>
        <option>11</option>
        <option>12</option>
        <option>13</option>
        <option>14</option>
        <option>15</option>
        <option>16</option>
        <option>17</option>
        <option>18</option>
        <option>19</option>
        <option>20</option>
        <option>21</option>
        <option>22</option>
        <option>23</option>
        <option>24</option>
        <option>25</option>
        <option>26</option>
        <option>27</option>
        <option>28</option>
        <option>29</option>
        <option>30</option>
        <option>31</option>
      </select>
    </label><br>
    <label><input type="checkbox" name="search" value="WeekdaySlots">Find all open timeslots on
      <select>
        <option value="closeDayOfWeek">Day of the Week</option>
        <option value="MonClose">Mondays</option>
        <option value="TueClose">Tuesdays</option>
        <option value="WedClose">Wednesdays</option>
        <option value="ThuClose">Thursdays</option>
        <option value="FriClose">Fridays</option>
      </select>
    </label><br>
    <label><input type="checkbox" name="search" value="WeekdaySlots">Find all open timeslots at
      <select>
        <option value="openTimeslot">Time Slot</option>
        <option value="slot1">Add timeslots to this dropdown</option>
      </select>
    </label><br>
    <input type="submit" value="Submit">
  </form>
    </fieldset>
    <br>
    <fieldset>
      <legend>Schedule View</legend>
      The Secret Code to view this Schedule is: <input name="SecretCodeParticipantSchedule" readonly/>
      <br><br><br><br><br><br><br><br><br><br><br><br>
    </fieldset>
    <br>
    <fieldset>
      <legend>List of available Meetings</legend>
      The area where the searched Meetings will appear
      <br><br><br><br><br><br><br><br><br><br>
    </fieldset>
    <br>
    <fieldset>
      <legend>Meeting View</legend>
      Your Secret Code for this Meeting is: <input name="SecretCodeMeeting" readonly/>
      <br><br>
      MEETING DETAILS HERE
      <br>
    </fieldset>
  </section>
</body>
</html>
