<!doctype html>
<html lang="en-US">
<head>
<style>
table, th, td {
    border: 1px solid black;
}
</style>

<!-- THIS DOC IS A THIRD ATTEMPT AT CREATING THE CALENDAR, MORE SPECIFICALLY TAILORED TO OUR WEEKLY SCHEDULE -->

<div class="container">
 <header> <a href="">
   <h4 class="logo">Calendar View</h4>
   </a>
 </header>
</div>
<script>

var startDate = new Date('2018-12-04T00:00:00'); // a date
var endDate = new Date('2018-12-12T23:00:00'); // a date
var timeSlotSizeString = "15"; //10, 15, 20, 30, 60
var timeSlotSize = parseInt(timeSlotSizeString);
var startTime = startDate.getHours(); // a time
var endTime = endDate.getHours(); // a time



// the variables that are gotten from those initial data values
var startDayOfWeek = startDate.getDay();
var endDayOfWeek = endDate.getDay();
var timeSlotAmount = 60 / window.timeSlotSize * (window.endTime - window.startTime);

// sets up variables that are used in display
Months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec' ];



//Sets up the unfinished weeks that will be created in the calendar by setting the first Monday and final Friday
// = in javascript is stupid and doesnt make a copy of the variable
var mondayOfStartWeek = new Date();
mondayOfStartWeek.setTime(startDate.getTime());
var fridayOfEndWeek = new Date();
fridayOfEndWeek.setTime(endDate.getTime());

mondayOfStartWeek.setDate(mondayOfStartWeek.getDate());
fridayOfEndWeek.setDate(fridayOfEndWeek.getDate());

console.log("startDate0: " + startDate)
// functions to get the monday of the start week and the friday of the end week
for (var i=startDayOfWeek; i>1; i--){
	mondayOfStartWeek.setDate(mondayOfStartWeek.getDate() - 1);
}

for (var i=endDayOfWeek; i<5; i++){
	fridayOfEndWeek.setDate(fridayOfEndWeek.getDate() + 1);
}
console.log(mondayOfStartWeek);
console.log(fridayOfEndWeek);

//Set the live variables to build the calendar view
var currentMonth = mondayOfStartWeek.getMonth();
var currentyear = mondayOfStartWeek.getYear();
var buildScheduleYear = window.mondayOfStartWeek.getFullYear();
var buildScheduleMonth = window.mondayOfStartWeek.getMonth();
var buildScheduleDay = window.mondayOfStartWeek.getDate();
var buildScheduleDayOfWeek = window.mondayOfStartWeek.getDay();
var buildScheduleHour = window.startDate.getHours();

//Build the calendar
function buildCalendar(mondayOfBuildWeek, scheduleStartDate, isFirstWeek){
  if (isFirstWeek == 1){
    startOfSchedule = window.startDate;
    console.log(startOfSchedule + " " + window.startDate)
    buildScheduleDate = window.mondayOfStartWeek;
    buildScheduleMonth = window.mondayOfStartWeek.getMonth();
    buildScheduleYear = window.mondayOfStartWeek.getFullYear();
  }
  else {
    console.log("MondayofBuildWeek: "+ mondayOfBuildWeek);
    startOfSchedule = scheduleStartDate
    buildScheduleDate = mondayOfBuildWeek;
    buildScheduleMonth = mondayOfBuildWeek.getMonth();
    buildScheduleYear = mondayOfBuildWeek.getFullYear();
  }
  console.log("buildScheduleDate " + buildScheduleDate)
  // this is just a loop to get the words for the month
  for (var i=0; i<12; i++){
    if (buildScheduleMonth == i){
      var monthDisplay = Months[i];
    }
  }
  // this prints out the heading of the table
  document.write(monthDisplay + " " + buildScheduleYear);
	document.write('<table><tr><th>TIMESLOT</th><th>Mon ' + (buildScheduleDate.getDate()+0) + '</th><th>Tue ' + (buildScheduleDate.getDate()+1) + '</th><th>Wed ' + (buildScheduleDate.getDate()+2) + '</th><th>Thu ' + (buildScheduleDate.getDate()+3) + '</th><th>Fri ' + (buildScheduleDate.getDate()+4) + '</th></tr>');
  for (var i=buildScheduleDate.getHours(), d=1; i<window.endDate.getHours(); i+= timeSlotSize/60){
    document.write('<tr>');
    document.write('<td>'+ (i) +'</td>');
    for (var j=1; j <= 5; j ++){
      if ((startOfSchedule.getDay()-1) < j){
        document.write("<td>this is the " + d + "th meeting on the "+ j + "th day" + "</td>");
      }
      else{
        document.write("<td>This day is out of Schedule!</td>");
      }
		}
    document.write('</tr>');
    d++;
	}
  document.write('</table>');
}
buildCalendar(null,null,1)



function nextWeek(modayOfCurrentWeek){
	return mondayOfCurrentWeek.setDate(modayOfCurrentWeek.getDate + 7);
}
function prevWeek(modayOfCurrentWeek){
	return mondayOfCurrentWeek.setDate(modayOfCurrentWeek.getDate - 7);
}
function setWeek(monday, date){
  buildCalendar(monday, date, 0);
}

function findMonday(date){
  return null
}
//setWeek(new Date('2018-12-10T05:00:00'), new Date('2018-12-11T05:00:00'));

//TODO FINISH TESTING THIS FUNCTION FOR FILLING IN ANY WEEK




console.log(timeSlotAmount);

function nextWeek(currentWeek){

}

function prevWeek(currentWeek){

}

function processResponseCalendar(result) {
  // Can grab any DIV or SPAN HTML element and can then manipulate its
  // contents dynamically via javascript
  console.log("result:" + result);
  var js = JSON.parse(result);
  var respString = js["response"];
  var id = js["id"];             // change to get the information that you need
  var code = js["secretCode"];   // change to get the information that you need
   // Update computation result
  document.getElementById("secretCodeOrganizer").value = code;
  document.getElementById("scheduleIdOrganizer").value = id;
  window.alert(respString);
}

xhr.onloadend = function () {
    console.log(xhr);
    console.log(xhr.request);
    if (xhr.readyState == XMLHttpRequest.DONE) {
      console.log ("XHR:" + xhr.responseText);
      processResponseCalendar(xhr.responseText);
    } else {
      window.alert("Oops, something went wrong!");
    }
  };

</script>

<div id="Calendar"></div>
Your Secret Code for this Schedule is: <input id="secretCodeOrganizer" readonly/>
and the ID to schedule Meetings is: <input id="scheduleIdOrganizer" readonly/>
